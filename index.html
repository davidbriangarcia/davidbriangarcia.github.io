<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoPlay - Automate Your PC</title>
  <link rel="icon" href="public/logo64.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans" data-page-key="index">

  <header id="app-header" class="bg-gray-800 shadow-md sticky top-0 z-40">
      <!-- Dynamic header content will be injected here -->
  </header>

  <section class="text-center py-10 px-4 bg-gradient-to-br from-blue-700 to-purple-700">
    <h1 class="text-4xl md:text-5xl font-bold mb-4">AutoPlay</h1>
    <p id="hero-subtitle" class="text-lg md:text-xl mb-6">Automate your PC like a pro. Record and run macros with precision.</p>
    <div class="mt-4">
      <button id="download-btn" class="bg-white text-gray-900 font-bold px-6 py-3 rounded hover:bg-gray-200 inline-block">
        <span id="hero-download">Download AutoPlay Now!</span>
      </button>
      <p id="hero-eula" class="mt-2 text-sm text-gray-300">
        By downloading, you agree to the <a href="/eula" class="underline hover:text-white">EULA</a> and <a href="/privacy" class="underline hover:text-white">Privacy Policy</a>.
      </p>
    </div>
  </section>

  <section class="py-4 px-4 max-w-4xl mx-auto">
    <h2 id="features-title" class="text-3xl font-bold text-center mb-8">What can you do with AutoPlay?</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-1-title" class="font-semibold text-xl mb-2">üé• Record and replay actions</h3>
        <p id="feature-1-desc">Capture clicks, mouse movements, and keystrokes with millimetric precision.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-2-title" class="font-semibold text-xl mb-2">üî•Assign hotkeys to boring actions.</h3>
        <p id="feature-2-desc">Run your macros with a single key or key combination to automate actions effortlessly.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-9-title" class="font-semibold text-xl mb-2">‚è∞Schedule macros to run at specific times.</h3>
        <p id="feature-9-desc">Set macros to execute at specific times or intervals, automating tasks even when you're away.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-10-title" class="font-semibold text-xl mb-2">üñ•Ô∏èRun a macro when a region of screen change</h3>
        <p id="feature-10-desc">Automatically trigger a macro when a specific screen area updates, perfect for monitoring notifications and responding instantly.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-3-title" class="font-semibold text-xl mb-2">‚ö° Quick execution</h3>
        <p id="feature-3-desc">Assign pre-recorded macros to side buttons to launch them instantly.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-4-title" class="font-semibold text-xl mb-2">üõ†Ô∏è Advanced modifiers</h3>
        <p id="feature-4-desc">Add delay or repeat your macros as many times as you want.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-5-title" class="font-semibold text-xl mb-2">ü™∂ Portable and lightweight</h3>
        <p id="feature-5-desc">No installers or setup. Just download the 5MB .exe, and run it.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-6-title" class="font-semibold text-xl mb-2">üíæ Save and load macros</h3>
        <p id="feature-6-desc">Export your macros as .json files for easy reuse.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-7-title" class="font-semibold text-xl mb-2">üîê Secure by design</h3>
        <p id="feature-7-desc">Your data stays safe with built-in encryption and auto-login secured.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg">
        <h3 id="feature-8-title" class="font-semibold text-xl mb-2">üåê Multi-language ready</h3>
        <p id="feature-8-desc">Now available in English and Spanish ‚Äî more languages coming soon!</p>
      </div>

    </div>
  </section>

  <section class="py-12 px-4 text-center">
    <h2 id="preview-title" class="text-3xl font-bold mb-6">Program Preview</h2>
    <p id="preview-desc" class="mb-6 text-gray-300">This is how AutoPlay looks in action: recording and editing your macros.</p>
    <div class="w-full flex justify-center">
      <img src="captura-app.png"
           alt="AutoPlay Preview"
           class="rounded-lg shadow-lg"
           style="width: auto; height: auto;" />
    </div>
  </section>

  <section class="py-12 px-4 bg-gray-800">
    <h2 id="pricing-title" class="text-3xl font-bold text-center mb-8">Free vs PRO</h2>
    <div class="overflow-x-auto">
      <table class="table-auto w-full max-w-4xl mx-auto text-center border border-gray-700">
        <thead>
          <tr class="bg-gray-700">
            <th id="table-feature" class="p-4">Feature</th>
            <th id="table-free" class="p-4">Free</th>
            <th id="table-pro" class="p-4">PRO</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-t border-gray-600">
            <td id="feature-simultaneous" class="p-4">Simultaneous Macros</td>
            <td class="p-4">1</td>
            <td id="feature-simultaneous-pro" class="p-4">Unlimited</td>
          </tr>
          <tr class="border-t border-gray-600">
            <td id="feature-hotkeys" class="p-4">Hotkeys</td>
            <td class="p-4">‚úÖ</td>
            <td class="p-4">‚úÖ</td>
          </tr>
          <tr class="border-t border-gray-600">
            <td id="feature-saveload" class="p-4">Save/Load .json</td>
            <td class="p-4">‚úÖ</td>
            <td class="p-4">‚úÖ</td>
          </tr>
          <tr class="border-t border-gray-600">
            <td id="feature-support" class="p-4">Special Support</td>

            <td class="p-4">‚ùå</td>
            <td class="p-4">‚úÖ</td>
          </tr>
          <tr class="border-t border-gray-600">
            <td id="feature-future" class="p-4">Future </td>
            <td class="p-4">‚ùå</td>
            <td class="p-4">‚úÖ</td>
          </tr>
          <tr class="border-t border-gray-600 bg-gray-700 font-bold">
            <td id="table-price" class="p-4">Price</td>
            <td id="table-price-free" class="p-4">Free</td>
            <td id="table-price-pro" class="p-4 text-green-400">$2/ month</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="text-center py-16 px-4 bg-gradient-to-br from-purple-700 to-blue-700" id="download">
    <h2 id="cta-title" class="text-4xl font-bold mb-4">Unlock your productivity</h2>
    <p id="cta-subtitle" class="text-xl mb-6">For only <span class="font-bold text-green-300">$2 monthly</span> access the full power of AutoPlay.</p>
    <a id="cta-upgrade-btn" href="/login/" class="bg-white text-gray-900 font-bold px-8 py-4 rounded hover:bg-gray-200 inline-block text-lg">
        <span id="cta-upgrade-btn-text">Upgrade to PRO</span>
    </a>
    <p id="cta-compatibility" class="mt-4 text-sm text-gray-200">Compatible with Windows 10 and 11</p>
  </section>

  <footer class="text-center py-6 text-gray-500 text-sm bg-gray-900 border-t border-gray-700">
    <div class="flex justify-center space-x-4 mb-4">
        <a href="#" onclick="setLanguage('en'); return false;" class="hover:text-white">English</a>
        <a href="#" onclick="setLanguage('es'); return false;" class="hover:text-white">Espa√±ol</a>
        <a href="/about" class="hover:text-white">About</a>
        <a href="/portfolio" class="hover:text-white">Portfolio</a>
        <a href="/support" class="hover:text-white">Support</a>
        <a href="/help" class="hover:text-white">Help</a>
        <a href="/privacy" class="hover:text-white">Privacy</a>
    </div>
    <p id="footer-copyright">¬© 2025 DaveSoftwarePeru. All rights reserved.</p>
  </footer>

  <div id="download-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div id="modal-content" class="bg-gray-900 rounded-lg shadow-lg p-8 max-w-md w-full relative">
      <button id="close-modal" class="absolute top-2 right-2 text-gray-400 hover:text-white text-2xl">&times;</button>
      <h2 id="modal-title" class="text-2xl font-bold mb-4 text-center">Download AutoPlay</h2>
      <div class="mb-4">
        <label id="modal-version-label" for="version-select" class="block mb-1 font-semibold">Version:</label>
        <select id="version-select" class="w-full p-2 rounded bg-gray-800 text-white border border-gray-700">
          <option value="1.1.1.1">1.1.1.1 (Beta)</option>
          <option value="1.1.1.0">1.1.1.0</option>
          <option value="1.1.0.9">1.1.0.9</option>
          <option value="1.1.0.8">1.1.0.8</option>
        </select>
      </div>
      <div class="mb-4">
        <label id="modal-type-label" class="block mb-1 font-semibold">File type:</label>
        <div class="flex flex-col gap-2">
          <button id="modal-btn-installer" data-type="installer" class="download-option bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Recommended installer (.msi)</button>
          <button id="modal-btn-zip" data-type="zip" class="download-option bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded">ZIP (portable)</button>
          <button id="modal-btn-exe" data-type="exe" class="download-option bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded">Direct EXE (English only)</button>
        </div>
      </div>
      <p id="modal-hint" class="text-xs text-gray-400 text-center">
        <span id="modal-hint-text">Choose version and file type before downloading.</span>
        <br>
        <a id="modal-changelog-link" href="/changelog/" class="underline hover:text-white ml-1">Changelog</a>
      </p>
    </div>
  </div>

  <script type="module">
    import { getSupabaseClient } from '/public/supabase-client.js';

    async function handleLogout() {
        const supabase = await getSupabaseClient();
        const { error } = await supabase.auth.signOut();
        if (error) {
            console.error('Error logging out:', error);
        } else {
            updateUIForAuthState(false); // Re-render UI for logged-out state
        }
    }

    function updateUIForAuthState(isLoggedIn) {
        // 1. Update Header
        const headerContainer = document.getElementById('app-header');
        if (headerContainer) {
            let headerHtml = `
            <nav class="container mx-auto px-6 py-3 flex flex-col sm:flex-row sm:justify-between items-center">
                <a href="/" class="flex items-center space-x-2 mb-2 sm:mb-0">
                    <img src="/public/logo64.ico" alt="AutoPlay Logo" class="h-8 w-8">
                    <span class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">AutoPlay</span>
                </a>
                <div>`;
            if (isLoggedIn) {
                headerHtml += `<a href="/dashboard/" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>`;
                headerHtml += `<button id="logout-btn" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Logout</button>`;
            } else {
                headerHtml += `<a href="/login/" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Login</a>`;
                headerHtml += `<a href="/signup/" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Sign Up</a>`;
            }
            headerHtml += `</div></nav>`;
            headerContainer.innerHTML = headerHtml;

            if (isLoggedIn) {
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
            }
        }

        // 2. Update CTA Button
        const ctaButton = document.getElementById('cta-upgrade-btn');
        const ctaButtonText = document.getElementById('cta-upgrade-btn-text');
        if (ctaButton && ctaButtonText) {
            if (isLoggedIn) {
                ctaButton.href = '/dashboard/';
                ctaButtonText.textContent = 'Go to Dashboard';
            } else {
                ctaButton.href = '/login/';
                ctaButtonText.textContent = 'Upgrade to PRO';
            }
        }
    }

    async function checkSession() {
        const supabase = await getSupabaseClient();
        if (!supabase) {
            updateUIForAuthState(false);
            return;
        }
        
        const { data: { session } } = await supabase.auth.getSession();
        updateUIForAuthState(!!session);

        supabase.auth.onAuthStateChange((_event, session) => {
            updateUIForAuthState(!!session);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        checkSession();
    });
  </script>

  <script src="public/language-manager.js"></script>
  <script>
    document.getElementById('download-btn').onclick = function() {
      document.getElementById('download-modal').classList.remove('hidden');

      const lang = localStorage.getItem('preferredLanguage') || 'en';
      if (typeof setLanguage === 'function') setLanguage(lang);
    };
    document.getElementById('close-modal').onclick = function() {
      document.getElementById('download-modal').classList.add('hidden');
    };
    document.getElementById('download-modal').onclick = function(e) {
      if (e.target === this) {
        this.classList.add('hidden');
      }
    };
    document.querySelectorAll('.download-option').forEach(btn => {
      btn.onclick = function() {
        const version = document.getElementById('version-select').value;
        const type = btn.getAttribute('data-type');
        let url = '';
        if (type === 'installer') {
          url = `https://tugzzpqeuuwcipkcprsm.supabase.co/storage/v1/object/public/instaladores//AutoPlay-${version}-setup.exe`;
        } else if (type === 'zip') {
          url = `https://tugzzpqeuuwcipkcprsm.supabase.co/storage/v1/object/public/zips/AutoPlay-${version}.zip`;
        } else if (type === 'exe') {
          url = `https://tugzzpqeuuwcipkcprsm.supabase.co/storage/v1/object/public/exe/AutoPlay-${version}.exe`;
        }
        window.open(url, '_blank');
        document.getElementById('download-modal').classList.add('hidden');
      };
    });
  </script>

</body>
</html>
